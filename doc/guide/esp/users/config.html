<!-- BeginDsi "dsi/head.html" -->
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Embedthis Appweb 4.0.0 Documentation</title>
    <meta name="keywords" content="embedded web server, web server software, embedded HTTP, application web server, 
        embedded server, small web server, HTTP server, library web server, library HTTP, HTTP library" />
    <meta name="description" content="Embedthis Sofware provides commercial and open source embedded web servers for 
        devices and applications." />
	<meta name="robots" content="index,follow" />
	<link href="../../../doc.css" rel="stylesheet" type="text/css" />
	<link href="../../../print.css" rel="stylesheet" type="text/css" media="print"/>
    <!--[if IE]>
    <link href="../../../iehacks.css" rel="stylesheet" type="text/css" />
    <![endif]-->
</head>

<body>
    <div class="top">
        <a class="logo" href="http://appwebserver.org/">&nbsp;</a>
        <div class="topRight">
             <div class="search">
                 <form id="search" method="get" action="http://www.google.com/search" title="Search appwebserver.org">
                     <p>
                        <label for="q" title="Search">Search</label> 
                        <input type="text" id="q" name="q" size="15" maxlength="255" />
                        <input type="submit" id="submit" value="Go" /> 
                        <input type="hidden" name="domains" value="appwebserver.org" /> 
                        <input type="hidden" name="sitesearch" value="appwebserver.org" />
                    </p>
                 </form>
              </div>
            <!--TITLE-->Embedthis Appweb 4.0.0
        </div>
        <div class="crumbs">
            <a href="../../../product/index.html">Home</a>
<!-- EndDsi -->
             &gt;<a href="index.html">ESP Guide</a> &gt;
            <b>Embedded Server Pages</b>
        </div>
    </div>
    <div class="content">
        <div class="contentRight">
            <h2>Quick Nav</h2>
            <ul class="nav">
                <li><a href="#webServerInterface">Web Server Interface</a></li>
                <li><a href="#generator">Application Generator</a></li>
                <li><a href="#parser">Web Page Parser</a></li>
                <li><a href="#mvc">MVC</a></li>
                <li><a href="#models">Models</a></li>
                <li><a href="#views">Views</a></li>
                <li><a href="#viewPipeline">View Pipeline</a></li>
                <li><a href="#controllers">Controllers</a></li>
                <li><a href="#routing">Routing</a></li>
                <li><a href="#actions">Actions</a></li>
                <li><a href="#deployment">Developing</a></li>
                <li><a href="#deployment">Deployment</a></li>
            </ul>
<!-- BeginDsi "dsi/webFrameSeeAlso.html" -->
            <h1>See Also</h1>
            <ul class="nav">
                <li><a href="../../../guide/appweb/users/frameworks.html">Web Frameworks</a></li>
                <li><a href="../../../guide/appweb/users/cgi.html">CGI</a></li>
                <li><a href="../../../guide/esp/users/index.html">ESP</a></li>
                <li><a href="../../../guide/appweb/users/ejs.html">Ejscript</a></li>
                <li><a href="../../../guide/appweb/users/php.html">PHP</a></li>
                <li><a href="../../../guide/appweb/users/index.html">User Guide Overview</a></li>
                <li><a href="../../../guide/appweb/users/configuration.html">Configuring Appweb</a></li>
                <li><a href="../../../guide/appweb/users/ports.html">Ports and Binding</a></li>
                <li><a href="../../../guide/appweb/users/authorization.html">User Authorization</a></li>
                <li><a href="../../../guide/appweb/users/logFiles.html">Log Files</a></li>
                <li><a href="../../../guide/appweb/users/vhosts.html">Virtual Hosts</a></li>
                <li><a href="../../../guide/appweb/users/security.html">Security Considerations</a></li>
                <li><a href="../../../guide/appweb/users/ssl.html">SSL</a></li>
                <li><a href="../../../guide/appweb/users/modules.html">Loadable Modules</a></li>
                <li><a href="../../../guide/appweb/users/stages.html">Pipeline Stages</a></li>
                <li><a href="../../../guide/appweb/users/client.html">HTTP Client</a></li>
                <li><a href="../../../ref/appweb/architecture.html">Appweb Architecture</a></li>
            </ul>
<!-- EndDsi -->
        </div>
        <div class="contentLeft">
            <h1>Configuring ESP</h1>
            <p>Embedded Server Pages (ESP) is managed by a set of configuration directives in the <tt>appweb.conf</tt>
            configuration file. These directives permit manage:</p>
            <ul>
                <li>ESP applications</li>
                <li>ESP directory locations</li>
                <li>ESP Error handling</li>
                <li>Compilation and linking of ESP components</li>
                <li>URI parsing and routing</li>
                <li>Database access and binding</li>
            </ul>
            <h3 class="section">Use Cases</h3>
            <p>There are two primary use cases to consider when configuring ESP:</p>
            <ul>
                <li>ESP Pages</li>
                <li>ESP MVC applications</li>
            </ul>
            <p>The basic ESP configuration takes care of ESP pages and configures Appweb to process <tt>*.esp</tt> pages
            via the ESP handler. If you need to support ESP MVC applications, there are extra directives to configure
            Appweb routes to support each MVC application.</p>
            <a name="basic"></a>
            <h2 class="section">Basic Configuration</h2>
            <p>Before ESP can be used, the ESP web framework including the ESP handler must be loaded. ESP is packaged as 
            as an Appweb module called "<tt>mod_esp</tt>". This is loaded into Appweb via the <tt>LoadModule</tt>
            directive.
<pre>LoadModule espHandler mod_esp</pre>
            <p>This loads the <tt>mod_esp</tt> module and invokes the ESP module initialization routine that registers
            ESP with Appweb.</p>
            <h3>Configuring the ESP Handler</h3>
            <p>For ESP to receive incoming client requests, the Appweb router must be told what requests to send to ESP.
            The <tt>AddHandler</tt> directive below achieves this. It tells Appweb that the <tt>espHandler</tt> will service
            all URIs that end with "<tt>.esp</tt>".
<pre>AddHandler espHandler *.esp</pre>
            <p>This is all that is needed to service any ESP web page that ends with "<tt>.esp</tt>". If you want to
            ESP pages with another extension, you can specify extra extensions:</p>
<pre>AddHandler espHandler *.esp *.myesp</pre>
            <a name="errors"></a>
            <h2 class="section">Error Handling</h2>
            <p>If an ESP page has a syntax error or a run-time error, messages will be sent to the Appweb log file.
            This defaults to the file <tt>error.log</tt>. If appweb is run manually, you can see these message on 
            the console.</p> 
            <p>Often during development, it is useful to send errors back to the browser. To do this, add the following
            directive to appweb.conf.
<pre>EspShowErrors on</pre>
            <p>This will display errors to the browser in addition to sending the errors to the Appweb log.</p>
            <a name="dir"></a>
            <h3>ESP Directories</h3>
            <p>ESP has certain conventions and defaults as to where it locates controllers, pages, layouts and other
            components. If you follow these conventions, you will not need to manually configure ESP's directories.
            However, if you need to, you can modify these on a per-route basis via the <tt>EspDir</tt> directive.</p>
            The directories are:
            <table>
                <thead>
                    <tr><td>Directory</td><td>Purpose</td>
                </thead>
                <tbody>
                    <tr><td>cache</td><td>Location to store compiled ESP pages and controllers</td>
                    <tr><td>controllers</td><td>Location for controller source code</td>
                    <tr><td>db</td><td>Location for database files</td>
                    <tr><td>layouts</td><td>Location for ESP layout pages</td>
                    <tr><td>static</td><td>Location for static web content</td>
                    <tr><td>views</td><td>Location for ESP MVC view pages</td>
                </tbody>
            </table>
            <p>The <tt>EspDir</tt> directive sets a ESP directory location for the current route. For example:</p>
            <pre>EspDir cache ./modules</pre>
            <p>This will cause ESP to store and retrieve the shared libraries containing compiled ESP pages and controllers 
            to and from the modules directory.</p>
            <h3>Directory Sets</h3>
            <p>The EspDir command can also be used to set a pre-defined directory configuration. The directive
            <tt>EspDir mvc</tt> will set the various ESP directories to default values of the same name. i.e. 
            the controllers directory will be set to the <tt>controllers</tt> sub-directory under the route's 
            document root. When EspApp is used to define an ESP MVC application, the <tt>EspDir mvc</tt> command is 
            automatically applied.</p>
            <a name="reload"></a>
            <h2 class="section">Reloading</h2>
            <p>ESP supports an "edit-and-continue" development style where you can make modifications to ESP controllers
            and pages and when you click reload in your browser, the controller or page will be transparently 
            recompiled and reloaded. This can be a great boost for development productivity.</p>
            <p>If Appweb and ESP are built in debug mode (by configuring with <tt>./configure --debug</tt>) then ESP
            will automatically rebuild modified ESP pages and controllers. If Appweb and ESP are built in release mode,
            the default is to not reload. This default behavior can be modified via the
            <tt>EspUpdate</tt> directive. Setting the directive to "<tt>on</tt>" will enable the transparent 
            recompilation and reloading of modified items.</p>
            <a name="keep"></a>
            <h2 class="section">Keep Source</h2>
            <p>Sometimes, it is helpful to preserve intermediate "C" source files so that you can debug
            your application at the source code level. When an ESP page is parsed, it is blended with a layout page and
            then an intermediate C source file is generated. This is normally removed after compilation. Setting the
            <tt>EspKeepSource</tt> directive to "<tt>on</tt>" will cause ESP to preserve this intermediate source file
            in the <tt>cache</tt> directory.</p>
            <a name=""></a>
            <h2 class="section">MVC Applications</h2>
            <p>ESP MVC applications typically require a little more configuration, but the ESP defaults make this fairly
            painless.</p>
            <h3>Separate Config</h3>
            <p>To modularize each ESP application, it is best practice to create a separate config file for each 
            application. This per-application config file should be saved to the <tt>/etc/appweb/apps</tt> or 
            on Windows, the <tt>Embedthis Appweb/apps</tt> directory. When Appweb is started or restarted, it will
            parse all the config files under the <tt>apps</tt>. Installing or removing a config file for each 
            application under the <tt>apps</tt> directory is a simple way to add/remove an application.</p>
            <h3>One Line MVC Configuration</h3>
            <p>If your MVC application uses RESTful routes and follows the ESP defaults, the one-liner 
            <a href="../../appweb/users/dir/esp.html#espApp">EspApp</a>
            directive is typically all you need. This directive takes the following arguments:
            <pre>Esp URI-Prefix Directory RouteSet Database</pre>
            <p>This defines an ESP application at the given directory that will receive all
            requests that begin with specified URI prefix. This will define a new Route block, inheriting the existing
            configuration. For example, a "blog" application stored in the "./blog" directory using RESTful routes and
            storing data in a SQLite database could be configured via:</p>
            <pre>EspApp /myblog ./blog restful sqlite://blog/blog.sdb</pre>
            <p>With this configuration, Appweb will send all URIs that begin with <tt>/myblog</tt> to this Blog ESP
            application.</p>
            <a name="routes"></a>
            <h2 class="section">Routes</h2>
            <p>So far, we've covered the basics, but Appweb provides very powerful Routing and directives 
            that can be utilized to custom configure ESP applications. The EspApp directive is really a convenience
            directive that is equivalent to a set of lower-level directives. For example, the previous EspApp directive:
<pre class="light">EspApp /myblog ./blog restful sqlite://blog/blog.sdb</pre> 
            is equivalent to:</p>
<pre>
&lt;Route ^/myblog>
    Prefix /myblog
    DocumentRoot ./blog
    AddHandler espHandler
    EspDir restful
    EspDb sqlite://blog.mdb
    EspRouteSet restful                                                                                
&lt;/Route>  
</pre>
            <h3>REST and Resources</h3>
            <p>ESP supports using a RESTful design for mapping request URIs to resources.
            An application will typically deal with various resources that need to be managed. For example, a WIFI
            router UI will need to manage the WIFI network name and password.  A network switch application may 
            need to manage a group of ethernet ports. Using REST, these resources are mapped onto HTTP methods and  
            URIs in a simple and clear manner.</p>
            <p>ESP provides two directives to create URI routes for resources: </p>
                <ul>
                    <li>EspResource &mdash; Create routes for a singleton resource</li>
                    <li>EspResourceGroup &mdash; Create routes for a group of resources</li>
                </ul>
            <h3>EspResource</h3>
            <p>The EspResource directive is used to create a RESTful set of routes to manage a singleton resource.
            A singleton resource is one or more related properties that are managed as a unit, like the WIFI network
            name and password. These routes define URI routes for create, destroy, edit, init, show and  
            update functions. See the <a href="../../appweb/users/dir/esp.html#espResource">EspResource</a> reference
            for details of the actual routes created.</p>
            <h3>EspResourceGroup</h3>
            <p>The EspResourceGroup directive is used to create a RESTful set of routes to manage a singleton resource.
            A group of resources is one or more instances of a resource that can be managed individually, like the 
            "port" on a network switch.
            See the <a href="../../appweb/users/dir/esp.html#espResourceGroup">EspResourceGroup</a> reference
            for details of the actual routes created.</p>
            <h3>Custom Routes</h3>
            <p>Sometimes you need a specific, custom mapping of a URI to a ESP controller and action. You can do this
            with the lowest-level Appweb directives:
                <ul>
                    <li><a href="../../appweb/users/dir/route.html#route">Route</a></li>
                    <li><a href="../../appweb/users/dir/route.html#name">Name</a></li>
                    <li><a href="../../appweb/users/dir/route.html#source">Source</a></li>
                    <li><a href="../../appweb/users/dir/route.html#target">Target</a></li>
                </ul>
            <p>However, it is easier to use the EspRoute directive that will create a route for a URI and 
               map the URI to an ESP controller and action. For example: 
<pre>EspRoute administration POST ^/wifi/admin/login admin-login admin.c</pre>
            <p>This will map <tt>/wifi/admin/login</tt> URI to the <tt>admin</tt> controller and invoke 
                the <tt>login</tt> action.</p>
            See the <a href="../../appweb/users/dir/esp.html#espRoute">EspRoute</a> reference
            for details of the directive arguments.</p>
            <a name="database"></a>
            <h2 class="section">Databases</h2>
            <p>Databases can be specified and pre-opened via the <tt>EspDb</tt> directive. Pre-opening a
            database connection for an ESP application or route within an application eliminates the run-time delay 
            connecting to the database. 
            ESP supports multiple database engines through a single Embedded Database Interface. Support is included for
            SQLite, MySQL and MDB. See <a href="database.html">Database Interface</a> for more information about
            Database Support.</p>
            <p>The EspDb directive takes the form: <tt>EspDb provider://database-connection</tt>. For example:
<pre class="light">
  EspDb mdb://blog.mdb
or
  EspDb sqlite://sqlite.sdb
</pre>
            <p>For SQLite and MDB databases, the database-connection string is the name of the database in the ESP
            <tt>db</tt> directory. Databases can also be pre-opened via the 
                <a href="../../appweb/users/dir/esp.html#espApp">EspApp</a> directive.</p>
            <a name=""></a>
            <h2 class="section">Compilation</h2>
            <p>At development time, ESP need to compile ESP controllers and pages into native code.
            ESP supplies a pre-configured set of compilation commands for the major operating systems. These
            are stored in the <tt>esp.conf</tt> file which is located at <tt>/usr/lib/appweb/lib</tt> on Unix or on
            Windows at <tt>C:/Program Files/Embedthis Appweb/lib</tt>. The esp.conf file contains compile and link command
            templates using the <a href="../../appweb/users/dir/esp.html#espCompile">EspCompile</a> and optionally 
            <a href="../../appweb/users/dir/esp.html#espLink">EspLink</a>. For example:
<pre>
EspCompile cc -shared ${DEBUG} -Wall -Wno-unused-result \
    -DPIC -fPIC -I. -I${INC} \
    -L${LIB} -Wl,--enable-new-dtags \
    -Wl,-rpath,$ORIGIN/ \
    -Wl,-rpath,$ORIGIN/../lib ${LIBS} \
    -o ${OUT}${SHOBJ} ${SRC}
</pre>
                <p>The various tokens in braces "${token}", are expanded at runtime depending on the configuration of
                Appweb. The esp.conf configuration file has conditional sections for Cygwin, Windows, Mac OS X, VxWorks and
                a default section for Linux/Unix. You can customize this file to suit your system. </p>
                <p>Some systems require a separate link phase. The <a
                    href="../../appweb/users/dir/esp.html#espLink">EspLink</a> command can be used to do a separate
                link. Other systems require that various environment variables be defined for the compiler and linker to
                successfully run. Use the <a href="../../appweb/users/dir/esp.html#espEnv">EspEnv</a> command for this.
            <h3>Cross Compilation</h3>
            <p>When cross-compiling, invoke the <tt>esp</tt> command with the "<tt>--config</tt>" switch to specify a
            separate config file for compiling on the target. Copy the standard <tt>esp.conf</tt> and modify the compile
            and link targets as required</p>
            <h2 class="section">Directives List</h2>
            <p>The following is a list of the various ESP directives and their purpose. Click on the "purpose" text, to
            see the appropriate directive reference.</p>
            <table>
                <thead>
                    <tr><td>Directive</td><td>Purpose</td>
                </thead>
                <tbody>
                    <tr><td><a href="../../appweb/users/dir/esp.html#espApp">EspApp</td>
                            <td>Define an ESP web application</td></tr>
                    <tr><td><a href="../../appweb/users/dir/esp.html#espCompile">EspCompile</td>
                            <td>Compile command for ESP controllers and pages</td></tr>
                    <tr><td><a href="../../appweb/users/dir/esp.html#espDb">EspDb</td>
                            <td>Pre-open a database</td></tr>
                    <tr><td><a href="../../appweb/users/dir/esp.html#espDir">EspDir</td>
                            <td>Set an ESP directory location</td></tr>
                    <tr><td><a href="../../appweb/users/dir/esp.html#espEnv">EspEnv</td>
                            <td>Set an environment variable</td></tr>
                    <tr><td><a href="../../appweb/users/dir/esp.html#espKeepSource">EspKeepSource</td>
                            <td>Preserve intermediate page source code</td></tr>
                    <tr><td><a href="../../appweb/users/dir/esp.html#espLink">EspLink</td>
                            <td>Link command for ESP controllers and pages</td></tr>
                    <tr><td><a href="../../appweb/users/dir/esp.html#espLoad">EspLoad</td>
                            <td>Pre-load an ESP application that has been compiled flat</td></tr>
                    <tr><td><a href="../../appweb/users/dir/esp.html#espResource">EspResource</td>
                            <td>Create a set of routes for a singleton resource</td></tr>
                    <tr><td><a href="../../appweb/users/dir/esp.html#espResourceGroup">EspResourceGroup</td>
                            <td>Create a set of routes for a group of resources</td></tr>
                    <tr><td><a href="../../appweb/users/dir/esp.html#espRoute">EspRoute</td>
                            <td>Define and configure an ESP route</td></tr>
                    <tr><td><a href="../../appweb/users/dir/esp.html#espRouteSet">EspRouteSet</td>
                            <td>Create a pre-defined set of routes</td></tr>
                    <tr><td><a href="../../appweb/users/dir/esp.html#espShowErrors">EspShowErrors</td>
                            <td>Show ESP errors to the client</td></tr>
                    <tr><td><a href="../../appweb/users/dir/esp.html#espUpdate">EspUpdate</td>
                            <td>Reload updated ESP controllers and pages</td></tr>
                </tbody>
            </table>
        </div>
    </div>
<!-- BeginDsi "dsi/bottom.html" -->

	<div class="bottom">
		<p class="footnote"> 
            <a href="../../../product/copyright.html" >&copy; Embedthis Software LLC, 2003-2011. 
            All rights reserved. Embedthis, ESP, Ejscript and Appweb are trademarks of Embedthis Software LLC.</a>
		</p>
	</div>
<!-- EndDsi -->
</body>
</html>
