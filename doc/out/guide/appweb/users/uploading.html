<!DOCTYPE html>
<html lang="en">
<head>
    <title>Uploading</title>
    <!-- Copyright Embedthis Software, LLC, 2003-2014. All Rights Reserved. -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="keywords" content="embedded web server, web server software, embedded HTTP, application web server,
        embedded server, small web server, HTTP server, library web server, library HTTP, HTTP library" />
    <meta name="description" content="Embedthis Sofware provides commercial and open source embedded web servers for
        devices and applications." />
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,+Sans:300italic,400,300,700'
        rel='stylesheet' type='text/css'>
    <link href="/lib/semantic/packaged/css/semantic.css" rel="stylesheet" type="text/css" />
    <link href="/css/all.css" rel="stylesheet" type="text/css" />
    <link href="/images/favicon.ico" rel="shortcut icon" />

</head>
<body>
        
    <div class="ui large left vertical inverted labeled overlay sidebar menu">
        <div class="item">
            <a href="../../../">
                <b>General</b>
            </a>
            <div class="menu">
                <a class="item" href="../../../index.html">Appweb Overview</a>
                <a class="item" href="../../../guide/appweb/features.html">Appweb Features</a>
                <a class="item" href="../../../product/releaseNotes.html">Release Notes</a>
                <a class="item" href="https://github.com/embedthis/appweb/releases">Change Log</a>
                <a class="item" href="https://github.com/embedthis/appweb/milestones">Roadmap</a>
                <a class="item" href="https://embedthis.com/download/appweb.html">Download</a> 
                <a class="item" href="../../../product/compatibility.html">Compatibility</a>
                <a class="item" href="../../../licenses/index.html">Licensing</a>
            </div>
        </div>
        <div class="item">
            <a href="../../../guide/appweb/users/gettingStarted.html">
                <b>Getting Started</b>
            </a>
            <div class="menu">
                <a class="item" href="../../../guide/appweb/users/quickStart.html">Quick Start</a>
                <a class="item" href="../../../product/install/index.html">Installation</a>
                <a class="item" href="../../../guide/appweb/users/faq.html">Appweb FAQ</a>
                <a class="item" href="../../../guide/appweb/users/starting.html">Starting and Stopping</a>
                <a class="item" href="../../../guide/appweb/users/service.html">Running as a Service</a>
            </div>
        </div>
        <div class="item">
            <a href="../../../guide/appweb/users/index.html"><b>Users Guide</b></a>
            <div class="menu">
                <a class="item" href="../../../guide/appweb/users/configuration.html">Configuring Appweb</a>
                <a class="item" href="../../../guide/appweb/users/configuration.html#directives">Configuration Directives</a>
                <a class="item" href="../../../guide/appweb/users/frameworks.html">Web Frameworks</a>
                <a class="item" href="../../../guide/appweb/users/modules.html">Using Loadable Modules</a>
                <a class="item" href="../../../guide/appweb/users/ports.html">Ports and Binding</a>
                <a class="item" href="../../../guide/appweb/users/routing.html">Routing Requests</a>
                <a class="item" href="../../../guide/appweb/users/stages.html">Request Pipeline</a>
                <a class="item" href="../../../guide/appweb/users/lang.html">Multi-Language Content</a>
                <a class="item" href="../../../guide/appweb/users/authentication.html">User Authorization</a>
                <a class="item" href="../../../guide/appweb/users/logFiles.html">Logging</a>
                <a class="item" href="../../../guide/appweb/users/caching.html">Caching</a>
                <a class="item" href="../../../guide/appweb/users/vhosts.html">Virtual Hosts</a>
                <a class="item" href="../../../guide/appweb/users/ssl.html">Secure Sockets (SSL)</a>
                <a class="item" href="../../../guide/appweb/users/client.html">Http Client</a>
                <a class="item" href="../../../guide/appweb/users/security.html">Security Considerations</a>
                <a class="item" href="../../../guide/appweb/users/monitor.html">Monitoring and Defending</a>
                <a class="item" href="../../../guide/appweb/users/uploading.html">File Upload</a>
                <a class="item" href="../../../guide/appweb/users/webSockets.html">WebSockets</a>
            </div>
        </div>
        <div class="item">
            <a href="../../../guide/appweb/programmers/index.html">Programmer Guide</a>
            <div class="menu">
                <a class="item" href="../../../guide/appweb/programmers/embedding.html">Embedding Appweb</a>
                <a class="item" href="../../../guide/appweb/programmers/modules.html">Creating Appweb Modules</a>
                <a class="item" href="../../../guide/appweb/programmers/handlers.html">Creating Appweb Handlers</a>
                <a class="item" href="../../../guide/appweb/programmers/stages.html">Creating Pipeline Stages</a>
                <a class="item" href="../../../guide/appweb/programmers/migrating.html">Migrating to Appweb 5</a>
                <a class="item" href="../../../guide/appweb/programmers/rom.html">Serving Pages from ROM</a>
                <a class="item" href="../../../guide/appweb/programmers/man.html">Man Pages</a>
            </div>
        </div>
        <div class="item">
            <a href="../../../ref/appweb/index.html">Reference Guide</a>
            <div class="menu">
                <a class="item" href="../../../ref/appweb/native.html">API Library</a>
                <a class="item" href="../../../ref/appweb/memory.html">Appweb Memory Allocation</a>
                <a class="item" href="../../../ref/appweb/multithread.html">Multithreaded Programming</a>
                <a class="item" href="../../../ref/appweb/architecture.html">Appweb Architecture</a>
                <a class="item" href="../../../guide/appweb/standards/http.html">HTTP References</a>
            </div>
        </div>
        <div class="item">
            <a href="../../../guide/appweb/source/index.html">Source Code</a>
            <div class="menu">
                <a class="item" href="../../../guide/appweb/source/building.html">Building Appweb from Source</a>
                <a class="item" href="../../../guide/appweb/source/porting.html">Porting to New Platforms</a>
            </div>
        </div>
        <div class="item">
            <a href="../../../product/project.html">Project Resources</a>
            <div class="menu">
                <a class="item" href="https://github.com/embedthis/appweb">Source Code Repository</a>
                <a class="item" href="https://github.com/embedthis/appweb/issues">Project Issue Database</a>
                <a class="item" href="https://embedthis.com/scripts/contributors.esp">Contributors Agreement</a>
            </div>
        </div>
        <div class="item">
            <b>Links</b>
            <div class="menu">
                <a class="item" href="http://goo.gl/dGRDl4">Official Appweb News (Google+)</a>
                <a class="item" href="http://groups.google.com/group/appweb">Appweb Community Support</a>
                <a class="item" href="https://embedthis.com/">Embedthis Web Site</a>
                <a class="item" href="https://embedthis.com/appweb/">Appweb Web Site</a>
                <a class="item" href="https://embedthis.com/blog/">Embedthis Blog</a>
                <a class="item" href="http://twitter.com/mobstream">Twitter</a>
            </div>
        </div>
    </div>

    <div class="ui inverted masthead">
                <div class="column">
            <div class="inverted secondary pointing ui menu">
                <div class="header left item">
                    <!-- <a href="/index.html"><img src="/images/embedthis.png"></a> -->
                    <a href="/index.html">Appweb Documentation</a>
                </div>
                <div class="right menu">
                    <div class="ui top right">
                        <a class="item active" href="../../..//index.html">Documentation</a>
                        <a class="item" href="https://embedthis.com/appweb/">Appweb</a>
                        <a class="item" href="https://github.com/embedthis/appweb">Repository</a>
                        <a class="item" href="http://groups.google.com/group/appweb">Support</a>
                    </div>
                </div>
            </div>
            <div class="ui breadcrumb">
                <a class="section" href="../../../">Home</a>
                
                <div class="divider">/</div>
                <a class="section " href="index.html">
                    Users Guide
                </a>
                
                <div class="divider">/</div>
                <a class="section active" href="uploading.html">
                    Uploading
                </a>
                
            </div>
        </div>
        <div class="ui black small launch right attached toggle button" style="width: 40px;">
            <i class="icon list layout">
                <span class="text" style="display: none;">Menu</span>
            </i>
        </div>

    </div>
    <div class="content">
<h1>File Upload</h1>
            <p>Appweb has an integrated file upload filter that accepts and processes file upload requests.
            The Appweb upload filter intercepts uploaded files, saves them to disk and passes details about the 
            uploaded file to the request handler for processing.</p>
            <p>File upload uses multi-part mime encoding to transport files over HTTP POST requests. This is specified in
            the IETF standard <a href="http://www.ietf.org/rfc/rfc2388.txt">RFC 2388</a>. </p>
            <a id="overview"></a>
            <h2>Overview</h2>
            <p>Because uploaded files can be very large, Appweb uses specialized handling for the receipt, storage and
            processing of uploaded files. When an upload request is received, Appweb will accept and store the 
            uploaded file before starting the request handler to respond to the request. The request handler does not
            directly receive the uploaded file. Rather, Appweb passes the name of the temporary file holding the uploaded
            file.
            Appweb expects that the handler will process, copy or move the temporary file before completing the request.
            Once the handler has completed, Appweb will remove any remaining upload temporary files.</p>
            <a id="enabling"></a>
            <h2>Enabling File Upload</h2>
            <p>To enable the upload filter, you need to add it to the request pipeline via the
            <a href="dir/route.html#addInputFilter">AddInputFiler</a> directive. For example:
            <pre class="ui code segment">
&lt;Route /upload-uri&gt;
    <b>AddInputFilter uploadFilter</b>
    UploadDir /tmp
    UploadAutoDelete on
&lt;/Route&gt;
</pre>
            <p>It is good practice to define the uploadFilter within a qualifying route. This minimizes the
            security attack surface.</p>
            <a id="directives"></a>
            <h2>Appweb Upload Directives</h2>
            <p>There are three other appweb.conf directives that relate specifically to upload filter.</p>
            <ul>
                <li><a href="dir/sandbox.html#limitUpload">LimitUpload</a> &mdash; This specifies the maximum size an
                    uploaded file may be.</li>
                <li><a href="dir/route.html#uploadDir">UploadDir</a> &mdash; This specifies the directory to hold
                    uploaded files.</li>
                <li><a href="dir/route.html#uploadAutoDelete">UploadAutoDelete</a> &mdash; This specifies if the 
                    uploaded files should be automatically deleted from the upload directory after the handler has
                    completed processing the request.</li>
            </ul>
            <a id="details"></a>
            <h2>Upload File Details</h2>
            <p>Once a file is uploaded, the Appweb handler responsible for processing the request will receive details about
            uploaded files via the request parameters. 
            Different request handlers expose these request parameters 
            in different ways. </p>
            
            <h3>ESP Uploads</h3>
            <p>ESP provides direct access to the internal Appweb uploaded files structure. Each uploaded file is described
            by a <a href="../../../ref/appweb/api/http.html#group___http_upload_file">HttpUploadFile</a> structure. 
            These structures are stored in an MprHash table indexed by their HTML file upload ID.</p>
            <p>The <a href="../../../ref/appweb/api/http.html#group___http_upload_file">HttpUploadFile</a> structure is defined as:
            <pre class="ui code segment">
typedef HttpUploadFile {
    cchar *filename;        /* Local (temp) name of the file */
    cchar *clientFilename;  /* Client side name of the file */
    cchar *contentType;     /* Content type */
    ssize size;             /* Uploaded file size */
} HttpUploadFile;
</pre>
            <p>You can access uploaded files via:</p>
<pre class="ui code segment">
HttpConn        *conn;
HttpUploadFile  *file;
MprKey          *kp;
conn = getConn();
for (ITERATE_KEY_DATA(conn-&gt;rx-&gt;files, kp, file)) {
    render("FILENAME %s\n", file-&gt;filename);
    render("CLIENT_NAME %s\n", file-&gt;clientFilename);
    render("TYPE %s\n", file-&gt;contentType);
    render("SIZE %d\n", file-&gt;size);
}
</pre>
            <h3>Ejscript Uploads</h3>
            <p>Ejscript stores uploaded files in the <em><a
                    href="https://embedthis.com/ejs/doc/api/ejscript/ejs.web-Request.html">request.files</a></em> property. Files is an object hash
            of files indexed by the HTML ID. Each file is represented by an instance of the 
            <a href="https://embedthis.com/ejs/doc/api/ejscript/ejs.web-UploadFile.html">UploadFile</a> class.
            <a id="post"></a>
            <h2>Alternative Upload Technique</h2>
            <p>File upload using POST requests is one way to upload files. Another is to use the HTTP PUT method.
            This uploads a file without encoding and can offer higher performance. The HTTP DELETE method can then
            be used to delete files from the server.</p>
            <h3>CGI Upload</h3>
            <p>CGI provides them to applications via environment variables that start with <em>FILE_</em>. The variables
            end with an <em>ID</em> which is a sequential index for the file beginning at <em>0</em> for the first file.</p>
            <ul>
                <li>FILE_CLIENT_FILENAME_ID &mdash; the client specified filename </li>
                <li>FILE_CONTENT_TYPE_ID &mdash; the file mime content type</li>
                <li>FILE_FILENAME_ID &mdash; the local temporary filename containing the data</li>
                <li>FILE_SIZE_ID &mdash; the size of the uploaded file</li>
            </ul>
            <h3>PHP Uploads</h3>
            <p>PHP has its own file upload handler and should not be confused with the higher performing Appweb 
            upload filter. If you wish to use the PHP upload mechanism, you must disable the upload filter for 
            your PHP requests. Do this by removing the <em>AddInputFilter uploadFilter</em> in the appweb.conf
            configuration file.</p>
            <p>If you wish to use the Appweb upload filter with PHP, you will see environment variables in the
            _POST collection. The naming is the same as that for the CGI handler described above.</p>
    </div>
    <div class="ui basic center aligned segment" id="terms">
        <p>&copy; Embedthis Software, 2003-2014. All rights reserved.
            Generated on Aug 14, 2014.
        </p>
    </div>

    <script src="/lib/jquery/jquery.js"></script>
    <script src="/lib/semantic/packaged/javascript/semantic.js"></script>
    <script>
        $('.sidebar').sidebar({overlay: false}).sidebar('toggle');
        $('.sidebar').first().sidebar('attach events', '.toggle.button');
    </script>
</body>
</html>
