<!DOCTYPE html>
<html lang="en">
<head>
    <title>Porting Appweb</title>
    <!-- Copyright Embedthis Software, LLC, 2003-2014. All Rights Reserved. -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="keywords" content="embedded web server, web server software, embedded HTTP, application web server,
        embedded server, small web server, HTTP server, library web server, library HTTP, HTTP library" />
    <meta name="description" content="Embedthis Sofware provides commercial and open source embedded web servers for
        devices and applications." />
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Open+Sans:300italic,400,300,700'
        rel='stylesheet' type='text/css'>
    <link href="../../../lib/semantic/packaged/css/semantic.css" rel="stylesheet" type="text/css" />
    <link href="../../../css/all.css" rel="stylesheet" type="text/css" />
    <link href="../../../images/favicon.ico" rel="shortcut icon" />

</head>
<body>
        
    <div class="ui large left vertical inverted labeled overlay sidebar menu">
        <div class="item">
            <a href="../../../">
                <b>General</b>
            </a>
            <div class="menu">
                <a class="item" href="../../../index.html">Appweb Overview</a>
                <a class="item" href="../../../guide/appweb/features.html">Appweb Features</a>
                <a class="item" href="../../../product/releaseNotes.html">Release Notes</a>
                <a class="item" href="https://github.com/embedthis/appweb/releases">Change Log</a>
                <a class="item" href="https://github.com/embedthis/appweb/milestones">Roadmap</a>
                <a class="item" href="https://embedthis.com/appweb/download.html">Download</a> 
                <a class="item" href="../../../product/compatibility.html">Compatibility</a>
                <a class="item" href="../../../licenses/index.html">Licensing</a>
            </div>
        </div>
        <div class="item">
            <a href="../../../guide/appweb/users/gettingStarted.html">
                <b>Getting Started</b>
            </a>
            <div class="menu">
                <a class="item" href="../../../guide/appweb/users/quickStart.html">Quick Start</a>
                <a class="item" href="../../../product/install/index.html">Installation</a>
                <a class="item" href="../../../guide/appweb/users/faq.html">Appweb FAQ</a>
                <a class="item" href="../../../guide/appweb/users/starting.html">Starting and Stopping</a>
                <a class="item" href="../../../guide/appweb/users/service.html">Running as a Service</a>
            </div>
        </div>
        <div class="item">
            <a href="../../../guide/appweb/users/index.html"><b>Users Guide</b></a>
            <div class="menu">
                <a class="item" href="../../../guide/appweb/users/configuration.html">Configuring Appweb</a>
                <a class="item" href="../../../guide/appweb/users/configuration.html#directives">Configuration Directives</a>
                <a class="item" href="../../../guide/appweb/users/frameworks.html">Web Frameworks</a>
                <a class="item" href="../../../guide/appweb/users/modules.html">Using Loadable Modules</a>
                <a class="item" href="../../../guide/appweb/users/ports.html">Ports and Binding</a>
                <a class="item" href="../../../guide/appweb/users/routing.html">Routing Requests</a>
                <a class="item" href="../../../guide/appweb/users/stages.html">Request Pipeline</a>
                <a class="item" href="../../../guide/appweb/users/lang.html">Multi-Language Content</a>
                <a class="item" href="../../../guide/appweb/users/authentication.html">User Authorization</a>
                <a class="item" href="../../../guide/appweb/users/logFiles.html">Logging</a>
                <a class="item" href="../../../guide/appweb/users/caching.html">Caching</a>
                <a class="item" href="../../../guide/appweb/users/vhosts.html">Virtual Hosts</a>
                <a class="item" href="../../../guide/appweb/users/ssl.html">Secure Sockets (SSL)</a>
                <a class="item" href="../../../guide/appweb/users/client.html">Http Client</a>
                <a class="item" href="../../../guide/appweb/users/security.html">Security Considerations</a>
                <a class="item" href="../../../guide/appweb/users/monitor.html">Monitoring and Defending</a>
                <a class="item" href="../../../guide/appweb/users/uploading.html">File Upload</a>
                <a class="item" href="../../../guide/appweb/users/webSockets.html">WebSockets</a>
            </div>
        </div>
        <div class="item">
            <a href="../../../guide/appweb/programmers/index.html">Programmer Guide</a>
            <div class="menu">
                <a class="item" href="../../../guide/appweb/programmers/embedding.html">Embedding Appweb</a>
                <a class="item" href="../../../guide/appweb/programmers/modules.html">Creating Appweb Modules</a>
                <a class="item" href="../../../guide/appweb/programmers/handlers.html">Creating Appweb Handlers</a>
                <a class="item" href="../../../guide/appweb/programmers/stages.html">Creating Pipeline Stages</a>
                <a class="item" href="../../../guide/appweb/programmers/migrating.html">Migrating to Appweb 5</a>
                <a class="item" href="../../../guide/appweb/programmers/rom.html">Serving Pages from ROM</a>
                <a class="item" href="../../../guide/appweb/programmers/man.html">Man Pages</a>
            </div>
        </div>
        <div class="item">
            <a href="../../../ref/appweb/index.html">Reference Guide</a>
            <div class="menu">
                <a class="item" href="../../../ref/appweb/native.html">API Library</a>
                <a class="item" href="../../../ref/appweb/memory.html">Appweb Memory Allocation</a>
                <a class="item" href="../../../ref/appweb/multithread.html">Multithreaded Programming</a>
                <a class="item" href="../../../ref/appweb/architecture.html">Appweb Architecture</a>
                <a class="item" href="../../../guide/appweb/standards/http.html">HTTP References</a>
            </div>
        </div>
        <div class="item">
            <a href="../../../guide/appweb/source/index.html">Source Code</a>
            <div class="menu">
                <a class="item" href="../../../guide/appweb/source/building.html">Building Appweb from Source</a>
                <a class="item" href="../../../guide/appweb/source/porting.html">Porting to New Platforms</a>
            </div>
        </div>
        <div class="item">
            <a href="../../../product/project.html">Project Resources</a>
            <div class="menu">
                <a class="item" href="https://github.com/embedthis/appweb">Source Code Repository</a>
                <a class="item" href="https://github.com/embedthis/appweb/issues">Project Issue Database</a>
                <a class="item" href="https://embedthis.com/developers/contributors.html">Contributors Agreement</a>
            </div>
        </div>
        <div class="item">
            <b>Links</b>
            <div class="menu">
                <a class="item" href="http://goo.gl/dGRDl4">Official Appweb News</a>
                <a class="item" href="http://groups.google.com/group/appweb">Community Support</a>
                <a class="item" href="https://embedthis.com/">Embedthis Web Site</a>
                <a class="item" href="https://embedthis.com/appweb/">Appweb Web Site</a>
                <a class="item" href="https://embedthis.com/blog/">Embedthis Blog</a>
                <a class="item" href="http://twitter.com/mobstream">Twitter</a>
            </div>
        </div>
    </div>

    <div class="ui inverted masthead">
                <div class="column">
            <div class="inverted secondary pointing ui menu">
                <div class="header left item">
                    <!-- <a href="/index.html"><img src="/images/embedthis.png"></a> -->
                    <a href="/index.html">Appweb Documentation</a>
                </div>
                <div class="right menu">
                    <div class="ui top right">
                        <a class="item" href="https://embedthis.com/appweb/">Appweb</a>
                        <a class="item" href="https://github.com/embedthis/appweb">Repository</a>
                        <a class="item" href="http://groups.google.com/group/appweb">Support</a>
                    </div>
                </div>
            </div>
            <div class="ui breadcrumb">
                <a class="section" href="../../../">Home</a>
                
                <div class="divider">/</div>
                <a class="section " href="../index.html">
                    Programmers Guide
                </a>
                
                <div class="divider">/</div>
                <a class="section " href="index.html">
                    Source Code Guide
                </a>
                
                <div class="divider">/</div>
                <a class="section active" href="porting.html">
                    Porting Appweb
                </a>
                
            </div>
        </div>
        <div class="ui black small launch right attached toggle button" style="width: 40px;">
            <i class="icon list layout">
                <span class="text" style="display: none;">Menu</span>
            </i>
        </div>

    </div>
    <div class="content">
<h1>Porting Appweb</h1>
            <p>Porting any software is not for the novice. It requires considerable skill to read another person's code
            and adapt it to a new environment. These instructions are intended for experienced developers who want to
            port Appweb to a new operating system or processor architecture.</p>
            <p>Appweb has been written to maximize the ease of porting to a new environment. The O/S and
            processor-dependent code have been contained while the bulk of the code is cross-platform. Most of this
            dependent code is under the <b>src/deps/mpr</b> sub-directory which represents the Multithreaded Portable
            Runtime (MPR).</p>
            <p><b>NOTE:</b> When attempting a port, you should get the latest copy of the development source 
            rather than using the download source package. You can get the latest development source by checking out a
            copy from the <a href="https://github.com/embedthis/appweb">repository</a>.</p>
            <p><b>NOTE:</b> Please read the general <a href="index.html">Working with Source</a> instructions 
            before your read this document. It provides essential background.</p>
            
            <a id="newOs"></a>
            <h2>Steps in Porting to a new Operating System</h2>
            <ol>
                <li><h3>Pick a Name for the O/S</h3>
                    <p>If you are doing a port for a new operating system, you need to pick a symbolic name that will
                    be used in conditional compilation, Makefiles, MakeMe files, and operating system specific 
                    directories. Some existing O/S names are: "linux", "windows", "freebsd", and "macosx".</p>
                    <p>These names are used as upper-case pre-processor defines and in some cases as lower-case
                        directory names.</p>
                </li>
                <li><h3>Select the base O/S to Copy</h3>
                    <p>The easiest way to port to a new O/S is to find the closest existing supported O/S that the
                    Appweb software already supports and use it as a base to modify. For example, if you are porting to
                    QNX, you may want to use the Linux port as a base.</p></li>
                <li><h3>Create the output products directory</h3>
                    <p>You need to create a directory for the build products: objects, binaries etc. This should 
                    be named OS-ARCH-PROFILE. For example: qnx-x86-debug. Under this directory create the inc, bin and 
                    obj directories.</p>
                    <pre class="ui code segment">
mkdir -p qnx-x86-debug/bin qnx-x86-debug/obj qnx-x86-debug/inc
</pre>
                <li><h3>Create the Makefile</h3>
                <p>Create the Makefile by copying the makefile for the similar O/S. i.e. in our example, 
                Copy the projects/appweb-linux.mk Makefile to projects/appweb-qnx.mk. Then edit the
                appropriate compiler and linker switches. Edit the top level Makefile if required to chain to this
                    new Makefile.</p>
                    <pre class="ui code segment">
cp projects/appweb-linux.mk projects/appweb-qnx.mk
vi projects/appweb-qnx.mk
</pre>
                </li>
                <li><h3>Tailor the cross-platform O/S header.</h3>
                    <p>To insulate most of the Appweb source code from the differences of various operating systems,
                    the <em>src/paks/osdep/osdep.h</em> header file wraps all the required O/S headers and publishes a
                    consistent set of types and prototypes. None of the source files include normal O/S headers like
                    &lt;string.h&gt;. While this does slow the build by including more headers than are required
                    &mdash; it is barely noticeable on modern CPUs.</p>
                    <p>When porting the osdep.h, start by copying the sections in osdep.h that pertain to your base 
                    copied O/S.
                    These will be protected by "#if BASEOS" defines. In the example of QNX, we would look for, and
                    copy, any sections with "#if LINUX" and create "#if QNX" sections.</p>
                    <p><b>DO NOT</b> introduce conditional code in other O/S sections. It is better to copy the entire
                    contents from the base O/S and modify. It is better to isolate the code for each O/S.</p>
                </li>
                <li><h3>Test the Headers with a Hello World Program.</h3>
                    <p>Don't use the make system yet. Just create an empty C hello world program and include "osdep.h".
                    Compile it and shake out the issues. </p>
                </li>
                <li><h3>Port the MPR Source Code</h3>
                <p>The Multithreaded Portable Runtime (MPR) wraps the operating system services and exposes
                    a portable, consistent interface for Appweb to utilize. 
                    So now is the time for the real work. You will need to modify the mprLib.c file to support your
                    new platform.
                    In mprLib.c, you will see banners marking where the various sub-files have been catenated together.
                    The main sections to modify will be socket.c, thread.c time.c and wait.c. Search for conditional
                    code sections for your base O/S and copy/modify as appropriate.
                </li>
                <li>
                    <h3>Test Compile the Mpr</h3>
                    <p>To start out, test compile just the MPR library. </p>
                    <pre class="ui code segment">
make NEWOS-ARCH-debug/obj/mprLib.o
</pre>
                    <p>At this stage of the porting effort, the <b>make</b> command will undoubtedly provoke a stream
                    of errors. Use this to work out the bugs in mpr.h and mprLib.c for your O/S.</p>
                </li>
                <li>
                    <h3>Compile the Rest</h3>
                    <p>After the MPR, it is more downhill. The rest of the code should compile and build more easily. 
                    It is quite cross-platform.</p>
                    <pre class="ui code segment">
make
</pre>
                </li>
                <li>
                    <h3>Test Appweb</h3>
                    <pre class="ui code segment">
cd test
appweb -v
</pre>
                </li>
            </ol>
            
            <a id="workingWithTheTeam"></a>
            <h2 class="section">Working with the Appweb Development Team</h2>
            <p>Once you have a basic port running, you should send it back for the team to look over. They can provide
            advice and suggestions. At the first opportunity, your changes may be merged back into the development tree
            so others can benefit from your work.</p>
            <p>Good luck and have fun. Please give feedback to the development team at <a href=
            "mailto:dev@embedthis.com">dev@embedthis.com</a>.</p>
    </div>
    <div class="ui basic center aligned segment" id="terms">
        <p>&copy; Embedthis Software, 2003-2014. All rights reserved.
            Generated on Aug 18, 2014.
        </p>
    </div>

    <script src="../../../lib/jquery/jquery.js"></script>
    <script src="../../../lib/semantic/packaged/javascript/semantic.js"></script>
    <script>
        $('.sidebar').sidebar({overlay: false}).sidebar('toggle');
        $('.sidebar').first().sidebar('attach events', '.toggle.button');
    </script>
</body>
</html>
