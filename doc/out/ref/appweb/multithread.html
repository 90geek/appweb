<!DOCTYPE html>
<html lang="en">
<head>
    <title>Multithreaded Programming</title>
    <!-- Copyright Embedthis Software, LLC, 2003-2014. All Rights Reserved. -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="keywords" content="embedded web server, web server software, embedded HTTP, application web server,
        embedded server, small web server, HTTP server, library web server, library HTTP, HTTP library" />
    <meta name="description" content="Embedthis Sofware provides commercial and open source embedded web servers for
        devices and applications." />
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Open+Sans:300italic,400,300,700'
        rel='stylesheet' type='text/css'>
    <link href="../../lib/semantic/packaged/css/semantic.css" rel="stylesheet" type="text/css" />
    <link href="../../css/all.css" rel="stylesheet" type="text/css" />
    <link href="../../images/favicon.ico" rel="shortcut icon" />

</head>
<body>
        
    <div class="ui large left vertical inverted labeled overlay sidebar menu">
        <div class="item">
            <a href="../../">
                <b>General</b>
            </a>
            <div class="menu">
                <a class="item" href="../../index.html">Appweb Overview</a>
                <a class="item" href="../../guide/appweb/features.html">Appweb Features</a>
                <a class="item" href="../../product/releaseNotes.html">Release Notes</a>
                <a class="item" href="https://github.com/embedthis/appweb/releases">Change Log</a>
                <a class="item" href="https://github.com/embedthis/appweb/milestones">Roadmap</a>
                <a class="item" href="https://embedthis.com/appweb/download.html">Download</a> 
                <a class="item" href="../../product/compatibility.html">Compatibility</a>
                <a class="item" href="../../licenses/index.html">Licensing</a>
            </div>
        </div>
        <div class="item">
            <a href="../../guide/appweb/users/gettingStarted.html">
                <b>Getting Started</b>
            </a>
            <div class="menu">
                <a class="item" href="../../guide/appweb/users/quickStart.html">Quick Start</a>
                <a class="item" href="../../product/install/index.html">Installation</a>
                <a class="item" href="../../guide/appweb/users/faq.html">Appweb FAQ</a>
                <a class="item" href="../../guide/appweb/users/starting.html">Starting and Stopping</a>
                <a class="item" href="../../guide/appweb/users/service.html">Running as a Service</a>
            </div>
        </div>
        <div class="item">
            <a href="../../guide/appweb/users/index.html"><b>Users Guide</b></a>
            <div class="menu">
                <a class="item" href="../../guide/appweb/users/configuration.html">Configuring Appweb</a>
                <a class="item" href="../../guide/appweb/users/configuration.html#directives">Configuration Directives</a>
                <a class="item" href="../../guide/appweb/users/frameworks.html">Web Frameworks</a>
                <a class="item" href="../../guide/appweb/users/modules.html">Using Loadable Modules</a>
                <a class="item" href="../../guide/appweb/users/ports.html">Ports and Binding</a>
                <a class="item" href="../../guide/appweb/users/routing.html">Routing Requests</a>
                <a class="item" href="../../guide/appweb/users/stages.html">Request Pipeline</a>
                <a class="item" href="../../guide/appweb/users/lang.html">Multi-Language Content</a>
                <a class="item" href="../../guide/appweb/users/authentication.html">User Authorization</a>
                <a class="item" href="../../guide/appweb/users/logFiles.html">Logging</a>
                <a class="item" href="../../guide/appweb/users/caching.html">Caching</a>
                <a class="item" href="../../guide/appweb/users/vhosts.html">Virtual Hosts</a>
                <a class="item" href="../../guide/appweb/users/ssl.html">Secure Sockets (SSL)</a>
                <a class="item" href="../../guide/appweb/users/client.html">Http Client</a>
                <a class="item" href="../../guide/appweb/users/security.html">Security Considerations</a>
                <a class="item" href="../../guide/appweb/users/monitor.html">Monitoring and Defending</a>
                <a class="item" href="../../guide/appweb/users/uploading.html">File Upload</a>
                <a class="item" href="../../guide/appweb/users/webSockets.html">WebSockets</a>
            </div>
        </div>
        <div class="item">
            <a href="../../guide/appweb/programmers/index.html">Programmer Guide</a>
            <div class="menu">
                <a class="item" href="../../guide/appweb/programmers/embedding.html">Embedding Appweb</a>
                <a class="item" href="../../guide/appweb/programmers/modules.html">Creating Appweb Modules</a>
                <a class="item" href="../../guide/appweb/programmers/handlers.html">Creating Appweb Handlers</a>
                <a class="item" href="../../guide/appweb/programmers/stages.html">Creating Pipeline Stages</a>
                <a class="item" href="../../guide/appweb/programmers/migrating.html">Migrating to Appweb 5</a>
                <a class="item" href="../../guide/appweb/programmers/rom.html">Serving Pages from ROM</a>
                <a class="item" href="../../guide/appweb/programmers/man.html">Man Pages</a>
            </div>
        </div>
        <div class="item">
            <a href="../../ref/appweb/index.html">Reference Guide</a>
            <div class="menu">
                <a class="item" href="../../ref/appweb/native.html">API Library</a>
                <a class="item" href="../../ref/appweb/memory.html">Appweb Memory Allocation</a>
                <a class="item" href="../../ref/appweb/multithread.html">Multithreaded Programming</a>
                <a class="item" href="../../ref/appweb/architecture.html">Appweb Architecture</a>
                <a class="item" href="../../guide/appweb/standards/http.html">HTTP References</a>
            </div>
        </div>
        <div class="item">
            <a href="../../guide/appweb/source/index.html">Source Code</a>
            <div class="menu">
                <a class="item" href="../../guide/appweb/source/building.html">Building Appweb from Source</a>
                <a class="item" href="../../guide/appweb/source/porting.html">Porting to New Platforms</a>
            </div>
        </div>
        <div class="item">
            <a href="../../product/project.html">Project Resources</a>
            <div class="menu">
                <a class="item" href="https://github.com/embedthis/appweb">Source Code Repository</a>
                <a class="item" href="https://github.com/embedthis/appweb/issues">Project Issue Database</a>
                <a class="item" href="https://embedthis.com/developers/contributors.html">Contributors Agreement</a>
            </div>
        </div>
        <div class="item">
            <b>Links</b>
            <div class="menu">
                <a class="item" href="http://goo.gl/dGRDl4">Official Appweb News (Google+)</a>
                <a class="item" href="http://groups.google.com/group/appweb">Appweb Community Support</a>
                <a class="item" href="https://embedthis.com/">Embedthis Web Site</a>
                <a class="item" href="https://embedthis.com/appweb/">Appweb Web Site</a>
                <a class="item" href="https://embedthis.com/blog/">Embedthis Blog</a>
                <a class="item" href="http://twitter.com/mobstream">Twitter</a>
            </div>
        </div>
    </div>

    <div class="ui inverted masthead">
                <div class="column">
            <div class="inverted secondary pointing ui menu">
                <div class="header left item">
                    <!-- <a href="/index.html"><img src="/images/embedthis.png"></a> -->
                    <a href="/index.html">Appweb Documentation</a>
                </div>
                <div class="right menu">
                    <div class="ui top right">
                        <a class="item" href="https://embedthis.com/appweb/">Appweb</a>
                        <a class="item" href="https://github.com/embedthis/appweb">Repository</a>
                        <a class="item" href="http://groups.google.com/group/appweb">Support</a>
                    </div>
                </div>
            </div>
            <div class="ui breadcrumb">
                <a class="section" href="../../">Home</a>
                
                <div class="divider">/</div>
                <a class="section " href="index.html">
                    Reference
                </a>
                
                <div class="divider">/</div>
                <a class="section active" href="multithread.html">
                    Multithreaded Programming
                </a>
                
            </div>
        </div>
        <div class="ui black small launch right attached toggle button" style="width: 40px;">
            <i class="icon list layout">
                <span class="text" style="display: none;">Menu</span>
            </i>
        </div>

    </div>
    <div class="content">
<h1>Multithreaded Programming</h1>
            <a id="overview"></a>
            <h2>Overview</h2>
            <p>Programming in a multithreaded environment can be difficult. Sometimes programming errors are timing related 
            as multiple threads interact. Multithread locks can become tangled and bugs can be difficult to reproduce. 
            To alleviate these problems and
            enable the benefits of a multi-threaded core, Appweb provides a suite of facilities to make multithreaded
            programming easier, more reliable, and more efficient.</p>
            <h3>The Problem of Multithreaded I/O Events</h3>
            <p>A particularly thorny issue in multithreaded servers is how to handle I/O without consuming a thread for
            each request. It is not practical to dedicate a thread to each HTTP request. A single browser will often
            send 6-10 simultaneous requests. If each request consumed a thread for the duration, the web server would
            quickly consume too many threads and system performance would greatly suffer. </p>
            <p>One solution is to use a thread pool. This allows a request to borrow a thread from a thread pool while 
            the request is active and return the thread when it cannot immediately continue with servicing the request. 
            A thread may
            not be able to continue because it is waiting for I/O from the client, or waiting for I/O to the client to 
            drain over the network. Returning the thread to the pool allows other requests to use the thread while the
            first request is waiting for network I/O. When the network is ready, a thread can be obtained from the pool
            and the original request can continue. For this to work, an efficient network event service is 
            essential. Appweb uses such a thread pool and event service to efficiently manage thread resources. </p>
            
            <p>However, this use of such an event service and thread pool raises another problem: races between the 
            foreground request thread and the background async I/O event thread. It is easy for these two threads to 
            simultaneously interact and corrupt critical data structures. A typical solution is to use multithread
            locks to serialize access to such data, but this is a crude solution and often leads to brittle applications.
            Appweb has a better solution that effectively serializes all activity for a request: per-request 
            event dispatchers.</p>
            <a id="dispatchers"></a>
            <h3>Event Dispatchers</h3>
            <p>The Multithreaded Portable Runtime (MPR) used by Appweb has a facility called Event Dispatchers. These
            are event queues on which all I/O and other event activity for a request can be queued and serviced. 
            Each request has its own dispatcher and so events for a request are serialized.  When a network I/O event
            is received by Appweb for a request, an event is queued on the request's dispatcher. If the request is 
            currently active (using a thread from the thread pool), the event is queued and no immediate action is taken. 
            When the request has finished its current activity, it will service events on its dispatcher queue and 
            eventually service the I/O event. If the request is currently idle, a thread is assigned from the thread 
            pool for the request, and the thread is resumed to service the request's dispatcher queue. This greatly 
            simplifies Appweb as all activity for a request is thus serialized via the dispatcher queue.</p>
            <p>By using event dispatchers, multithread locking is not required on every API &mdash; because activity
            is serialized by the dispatcher. This significantly boosts performance and reduces the risk of lock 
            contention.</p>
            <a id="multithreaded"></a>
            <h3>Multithreaded Appweb</h3>
            <p>By using request dispatchers, Appweb serializes all request activity, yet it can support many 
            simultaneous requests due to its multithreaded core. Appweb efficiently utilizes thread resources by using
            a thread pool and not permanently dedicating threads to requests. Threads are temporarily assigned
            only as required by active requests.</p>
            <a id="modules"></a>
            <h3>Modules</h3>
            <p>Appweb can be extended by writing loadable modules. Modules can add request handlers, pipeline filters,
            or network connectors. All module code can rely on the fact that request activity will be serialized and
            no locking is required to serialize I/O activity. Consequently, most module code can be effectively 
            single-threaded.</p>
            <p>Appweb can also be extended via Embedded Server Pages applications. These are loadable ESP web pages,
            and ESP Model-View-Controller applications. These too can rely on the fact that request activity is serialized
            and locking primitives are typically not required. ESP code can thus be simple, 
            single-threaded application code.</p>
            
            <a id="locking"></a>
            <h3>Locking</h3>
            <p>If you have a requirement for a data structure that will be accessed and manipulated simultaneously
            by multiple threads, the MPR provides a suite of locking primitives. See
            <a href="../../ref/appweb/api/mpr.html#group___mpr_synch">MprSynch</a> for the MPR Multithreaded Synchronization 
                Services.</p>
    </div>
    <div class="ui basic center aligned segment" id="terms">
        <p>&copy; Embedthis Software, 2003-2014. All rights reserved.
            Generated on Aug 15, 2014.
        </p>
    </div>

    <script src="../../lib/jquery/jquery.js"></script>
    <script src="../../lib/semantic/packaged/javascript/semantic.js"></script>
    <script>
        $('.sidebar').sidebar({overlay: false}).sidebar('toggle');
        $('.sidebar').first().sidebar('attach events', '.toggle.button');
    </script>
</body>
</html>
