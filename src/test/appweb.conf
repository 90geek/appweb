#
#   appweb.conf -- Appweb unit testing configuration
#   

# ErrorLog              log/error.log rotate,limit=10K,level=2
# AccessLog             conf/log.conf append,rotate,limit=10K
# TraceRx               conn=5, first=2, headers=3, body=5, time=4, size=10240, filter="jpg,gif,png,ico,css,js"
# TraceTx               first=3, headers=3, body=5, size=10240, filter="jpg,gif,png,ico,css,js"
# TraceRx               conn:5, first:2, headers:3, body:5, time:4, size:10240, filter:"jpg,gif,png,ico,css,js"

#
#   - Use same rotate code for error log and access log
#   - Rotate policy
#       - rotate when size reaches certain level
#       - append ".N" to old files
#       - rename all 5 when size reaches limit. 
#   - Remove LogRotation
#   - Add access log
#   - Deprecate from doc CustomLog, LogLevel, LogTrace, LogTraceFilter
#   - Add time tracing

ErrorLog                stdout
# LogRotation           5 1

LogLevel                0
LogTrace                3 headers,request,response,time
LogTraceFilter          4096 "*" "gif,jpg,png,ico,css,ico"

# Listen                [::]:5100
Listen                  4100         # MAIN - dont remove comment
DocumentRoot            "web"

LoadModulePath          "../../out/bin:../../out/lib"

DirectoryIndex          index.html
PutMethod               on
TraceMethod             off
KeepAlive               on

Cache                   86400 html gif jpeg jpg png pdf ico js
Timeout                 600
KeepAliveTimeout        30
MaxKeepAliveRequests    200
ThreadLimit             8
LimitClients            40
LimitStageBuffer        65536
LimitChunkSize          32768

LimitUrl                1000000
LimitRequestHeaderCount 10000 
LimitRequestHeaderSize  10000000

LimitRequestBody        20000000000
LimitUploadSize         20000000000
LimitResponseBody       20000000000
LimitRequestFields      512
LimitRequestFieldSize   1000000

LimitMemoryMax          1000000000
LimitMemoryRedline      800000000
MemoryDepletionPolicy   exit      

UploadDir               .
UploadAutoDelete        on

AuthGroupFile           groups.db
AuthUserFile            users.db
AuthDigestQop           auth

SetConnector            netConnector
AddInputFilter          authFilter
AddOutputFilter         rangeFilter
AddFilter               chunkFilter
AddInputFilter          uploadFilter
AddHandler              fileHandler html git jpeg jpg png pdf ico css js

<if CGI_MODULE>
    LoadModule cgiHandler mod_cgi
    AddHandler cgiHandler exe cgi cgi-nph bat cmd pl py
    <Directory "${SERVER_ROOT}/cgi-bin">
    </Directory>
    ScriptAlias /cgi-bin/ "${SERVER_ROOT}/cgi-bin/"
    ScriptAlias /MyScripts/ "${SERVER_ROOT}/cgi-bin/"
    ScriptAlias /YourScripts/ "${DOCUMENT_ROOT}/"
    Action application/x-appweb-perl /usr/bin/perl
    Action application/x-appweb-python /usr/bin/python
    Action application/x-appweb-lua /usr/bin/lua
    Action application/x-appweb-ruby /usr/bin/ruby
    Action application/x-appweb-php /usr/bin/php
</if>

#MOB - temp
#AddHandler dirHandler
#Options Indexes
#IndexOrder ascending name
#IndexOptions FancyIndexing FoldersFirst

<if EJS_MODULE>
    LoadModule ejsHandler mod_ejs
    AddHandler ejsHandler ejs es
</if>

<if PHP_MODULE>
    LoadModule phpHandler mod_php
    # UnloadModule phpHandler 60
    AddHandler phpHandler php
</if>

<if ESP_MODULE>
    LoadModule espHandler mod_esp
    AddHandler espHandler *.esp
    include ${LIBDIR}/esp.conf
    EspDir cache cache
    EspKeepSource on
    EspShowErrors on
    EspUpdate on
    EspLifespan 3600
    EspRoute esp ALL %\.[eE][sS][pP]$

    <Location /app>
		# EspLoad app app/cache/app
        EspAlias /app app mvc
        # EspReset routes
        # EspDir mvc
		# MOB - put routes here
        # EspRoute home    GET,POST,PUT     %^/$                        ${STATIC_DIR}/index.esp
        # EspRoute static  GET              %^/static/(.*)              ${STATIC_DIR}/$1
        # EspRoute default GET,POST         ^/{controller}(/{action})   ${controller}-${action} ${controller}.c
        # EspRoute esp GET,POST,PUT,DELETE  %\.[eE][sS][pP]$
        # AddHandler espHandler
    </Location>

    EspAlias /app2 app mvc

#   <EspRoute static>
#   	EspUri          %^/static/
#   </EspRoute>
#
#   EspRouteLine esp GET,POST,PUT,DELETE   %\.esp$
#   <EspRoute default>
#        # EspRestUri    /prefix
#        EspUri          ^/{controller}(/{action})
#        EspMatchHeader  User-Agent  /pattern/
#        EspMethods      GET,POST    
#        EspAction       ${controller}-${action}
#        EspController   ${controller}.c
#    </EspRoute>
</if>

<if SSL_MODULE>
    LoadModule sslModule mod_ssl
    SSLCertificateFile "ssl/server.crt"
    SSLCertificateKeyFile "ssl/server.key.pem"

    Listen 4110     # SSL - dont remove comment
    <VirtualHost *:4110>
        DocumentRoot "web"
        SSLEngine on
    </VirtualHost>                                  
</if>

Alias /SimpleAlias/ "${DOCUMENT_ROOT}/"
Alias /aliasDir/ ${DOCUMENT_ROOT}/alias/
Alias /aliasFile ${DOCUMENT_ROOT}/alias/index.html
Alias /AliasForMyDocuments/ "${DOCUMENT_ROOT}/My Documents/"

Listen 4111             # VHOST - dont remove comment
NameVirtualHost *:4111
<VirtualHost *:4111>
    ServerName      localhost:4111
    DocumentRoot    "${SERVER_ROOT}/web/vhost/namehost1"
</VirtualHost>

<VirtualHost *:4111>
    ServerName 127.0.0.1:4111
    DocumentRoot "${SERVER_ROOT}/web/vhost/namehost2"
    ResetPipeline
    AddHandler fileHandler html
    <if EJS_MODULE>
        AddHandler ejsHandler ejs
        DirectoryIndex index.ejs
    </if>
</VirtualHost>

#
#   IP virtual host
#
Listen 4112             # IPHOST
<VirtualHost *:4112>
    DocumentRoot "${SERVER_ROOT}/web/vhost/iphost"
    AuthType basic
    AuthName "Acme Inc"
    Require user mary
</VirtualHost>

#
#   Directories to test basic authentication (see testAuth)
#
<Directory ${DOCUMENT_ROOT}/basic>
    AuthType basic
    AuthName "Acme Inc"
    Require valid-user
</Directory>
<Directory ${DOCUMENT_ROOT}/basic/group>
    AuthType basic
    AuthName "Acme Inc"
    Require group acmeExec
</Directory>
<Directory ${DOCUMENT_ROOT}/basic/user>
    AuthType basic
    AuthName "Acme Inc"
    Require user joshua
</Directory>
<Directory ${DOCUMENT_ROOT}/digest>
    AuthType digest
    AuthName "Acme Inc"
    Require valid-user
</Directory>
<Directory ${DOCUMENT_ROOT}/digest/group>
    AuthType digest
    AuthName "Acme Inc"
    Require group acmeExec
</Directory>
<Directory ${DOCUMENT_ROOT}/digest/user>
    AuthType digest
    AuthName "Acme Inc"
    Require user joshua
</Directory>

Alias /blog /Users/mob/git/www/blog
<Directory /blog>
    DirectoryIndex index.php
</Directory>
Alias /forum /Users/mob/git/www/forum/appweb
<Directory /forum>
    DirectoryIndex index.php
</Directory>

AddHandler fileHandler ""

include conf/*
