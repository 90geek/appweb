#
#   appweb.conf -- Appweb unit testing configuration
#   

ErrorLog                stdout append,rotate
LogLevel                0
LogTrace                3 headers,request,response,time
LogTraceFilter          4096 "*" "gif,jpg,png,ico,css,ico"

# LogRotation           5 1
# ErrorLog              stdout append,rotate

ServerRoot              .
# Chroot                .

Listen                  4100         # MAIN - dont remove comment
Listen                  5100         # MAIN - dont remove comment
DocumentRoot            "web"

LoadModulePath          "../../out/modules"

DirectoryIndex          index.html
PutMethod               on
TraceMethod             off
KeepAlive               on

Cache                   86400 html gif jpeg jpg png pdf ico js
Timeout                 600
KeepAliveTimeout        30
MaxKeepAliveRequests    200
ThreadLimit             8
LimitClients            40
LimitStageBuffer        65536
LimitChunkSize          32768

LimitUrl                1000000
LimitRequestHeaderCount 10000 
LimitRequestHeaderSize  10000000

LimitRequestBody        20000000000
LimitUploadSize         20000000000
LimitResponseBody       20000000000
LimitRequestFields      512
LimitRequestFieldSize   1000000

LimitMemoryMax          1000000000
LimitMemoryRedline      800000000
MemoryDepletionPolicy   exit      

UploadDir               .
UploadAutoDelete        on

AuthGroupFile           groups.db
AuthUserFile            users.db
AuthDigestQop           auth

SetConnector            netConnector
AddOutputFilter         authFilter
AddOutputFilter         rangeFilter
AddFilter               chunkFilter
AddInputFilter          uploadFilter
AddHandler fileHandler html gif jpeg png pdf

<if CGI_MODULE>
    LoadModule cgiHandler mod_cgi
    AddHandler cgiHandler exe cgi cgi-nph bat cmd pl py
    <Directory "$SERVER_ROOT/cgi-bin">
    </Directory>
    ScriptAlias /cgi-bin/ "$SERVER_ROOT/cgi-bin/"
    ScriptAlias /MyScripts/ "$SERVER_ROOT/cgi-bin/"
    ScriptAlias /YourScripts/ "$DOCUMENT_ROOT/"
    Action application/x-appweb-perl /usr/bin/perl
    Action application/x-appweb-python /usr/bin/python
    Action application/x-appweb-lua /usr/bin/lua
    Action application/x-appweb-ruby /usr/bin/ruby
    Action application/x-appweb-php /usr/bin/php
</if>

AddHandler dirHandler
Options Indexes
IndexOrder ascending name
IndexOptions FancyIndexing FoldersFirst

LoadModule egiTestModule egiTest
AddHandler egiHandler egi
<Location /egi/>
    SetHandler egiHandler
</Location>
<Location /MyInProcScripts/>
    SetHandler egiHandler
</Location>

<if EJS_MODULE>
    LoadModule      ejsHandler mod_ejs
    AddHandler      ejsHandler ejs es
</if>

<if PHP_MODULE>
    LoadModule phpHandler mod_php
    # UnloadModule phpHandler 60
    AddHandler phpHandler php
</if>

<if SSL_MODULE>
    LoadModule sslModule mod_ssl
    SSLCertificateFile "ssl/server.crt"
    SSLCertificateKeyFile "ssl/server.key.pem"

    Listen 4110     # SSL - dont remove comment
    <VirtualHost *:4110>
        DocumentRoot "web"
        SSLEngine on
    </VirtualHost>                                  
</if>

Alias /SimpleAlias/ "$DOCUMENT_ROOT/"
Alias /aliasDir/ $DOCUMENT_ROOT/alias/
Alias /aliasFile $DOCUMENT_ROOT/alias/index.html
Alias /AliasForMyDocuments/ "$DOCUMENT_ROOT/My Documents/"

Listen 4111             # VHOST - dont remove comment
NameVirtualHost *:4111
<VirtualHost *:4111>
    ServerName      localhost:4111
    DocumentRoot    "$SERVER_ROOT/web/vhost/namehost1"
</VirtualHost>

<VirtualHost *:4111>
    ServerName 127.0.0.1:4111
    DocumentRoot "$SERVER_ROOT/web/vhost/namehost2"
    ResetPipeline
    AddHandler fileHandler html
    <if EJS_MODULE>
        AddHandler ejsHandler ejs
        DirectoryIndex index.ejs
    </if>
    <Location /myEgi/>
        SetHandler egiHandler
    </Location>
</VirtualHost>

#
#   IP virtual host
#
Listen 4112             # IPHOST
<VirtualHost *:4112>
    DocumentRoot "$SERVER_ROOT/web/vhost/iphost"
    AuthType basic
    AuthName "Acme Inc"
    Require user mary
</VirtualHost>

#
#   Directories to test basic authentication (see testAuth)
#
<Directory $DOCUMENT_ROOT/basic>
    AuthType basic
    AuthName "Acme Inc"
    Require valid-user
</Directory>
<Directory $DOCUMENT_ROOT/basic/group>
    AuthType basic
    AuthName "Acme Inc"
    Require group acmeExec
</Directory>
<Directory $DOCUMENT_ROOT/basic/user>
    AuthType basic
    AuthName "Acme Inc"
    Require user joshua
</Directory>
<Directory $DOCUMENT_ROOT/digest>
    AuthType digest
    AuthName "Acme Inc"
    Require valid-user
</Directory>
<Directory $DOCUMENT_ROOT/digest/group>
    AuthType digest
    AuthName "Acme Inc"
    Require group acmeExec
</Directory>
<Directory $DOCUMENT_ROOT/digest/user>
    AuthType digest
    AuthName "Acme Inc"
    Require user joshua
</Directory>

Alias /blog /Users/mob/git/www/blog
<Directory /blog>
    DirectoryIndex index.php
</Directory>
Alias /forum /Users/mob/git/www/forum/appweb
<Directory /forum>
    DirectoryIndex index.php
</Directory>

#
#   Ejs application configuration models (Alias, Location, VirtualHost)
#
EjsAlias                    /farm /users/mob/git/farm farm 5

<Location /myfarm>
    EjsStartup              farm
    EjsWorkers              5
    Alias /myfarm           /Users/mob/git/farm
    AddHandler              fileHandler html gif jpeg jpg png pdf ico css js
    AddHandler              ejsHandler
</Location>

Listen 4040
<VirtualHost *:4040>
    DocumentRoot            "."
    AddHandler              fileHandler html gif jpeg jpg png pdf ico css js
    AddHandler              ejsHandler
    EjsStartup              farm
</VirtualHost>

AddHandler fileHandler ""
