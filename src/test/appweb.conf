#
#   appweb.conf -- Appweb configuration MPR testing
#   

ErrorLog stdout
LogLevel 0
LogTrace 3 headers,request,response,time
LogTraceFilter 4096 "*" "gif,jpg,png,ico"

ServerRoot .
# Chroot .

Listen 4100         # MAIN - dont remove comment
DocumentRoot "web"
DirectoryIndex index.html
LoadModulePath "../../out/modules"

DirectoryIndex index.html
PutMethod on
KeepAlive on

Expires 86400 text/html image/gif

Timeout                      30
KeepAliveTimeout             30
MaxKeepAliveRequests        200
ThreadLimit                  20
LimitClients                 40
LimitStageBuffer           8192
LimitChunkSize             8192

LimitUrl                1000000
LimitRequestHeaderCount   10000 
LimitRequestHeaderSize 10000000

# 100MB
LimitRequestBody      100000000
LimitUploadSize       100000000
LimitResponseBody     100000000

# 1GB
LimitMemoryMax       1000000000
LimitMemoryRedline   0800000000
MemoryDepletionPolicy      exit      
TraceMethod off

AuthGroupFile groups.db
AuthUserFile users.db
AuthDigestQop auth

UploadDir .
UploadAutoDelete on

SetConnector netConnector
AddOutputFilter authFilter
AddOutputFilter rangeFilter
AddFilter chunkFilter
AddInputFilter uploadFilter

<if CGI_MODULE>
    LoadModule cgiHandler mod_cgi
    AddHandler cgiHandler exe cgi cgi-nph bat cmd pl py
    <Directory "$SERVER_ROOT/cgi-bin">
    </Directory>
    ScriptAlias /cgi-bin/ "$SERVER_ROOT/cgi-bin/"
    ScriptAlias /MyScripts/ "$SERVER_ROOT/cgi-bin/"
    ScriptAlias /YourScripts/ "$DOCUMENT_ROOT/"
    Action application/x-appweb-perl /usr/bin/perl
    Action application/x-appweb-python /usr/bin/python
    Action application/x-appweb-lua /usr/bin/lua
    Action application/x-appweb-ruby /usr/bin/ruby
    Action application/x-appweb-php /usr/bin/php
</if>

AddHandler dirHandler
Options Indexes
IndexOrder ascending name
IndexOptions FancyIndexing FoldersFirst

LoadModule egiTestModule egiTest
AddHandler egiHandler egi
<Location /egi/>
    SetHandler egiHandler
</Location>
<Location /MyInProcScripts/>
    SetHandler egiHandler
</Location>

<if EJS_MODULE>
    LoadModule ejsHandler mod_ejs
    AddHandler ejsHandler ejs es
    EjsStartup start.es
</if>

<if PHP_MODULE>
    LoadModule phpHandler mod_php
    UnloadModule phpHandler 60
    AddHandler phpHandler php
</if>
AddHandler fileHandler html gif jpeg png pdf ""

<if SSL_MODULE>
    Listen 4110     # SSL - dont remove comment
    LoadModule sslModule mod_ssl
    <VirtualHost *:4110>
        DocumentRoot "web"
        SSLEngine on
        # SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL
        SSLCipherSuite HIGH:MEDIUM
        SSLProtocol ALL -SSLV2
        SSLCertificateFile "ssl/server.crt"
        SSLCertificateKeyFile "ssl/server.key.pem"
    </VirtualHost>                                  
</if>

Alias /SimpleAlias/ "$DOCUMENT_ROOT/"
Alias /aliasDir/ $DOCUMENT_ROOT/alias/
Alias /aliasFile $DOCUMENT_ROOT/alias/index.html
Alias /AliasForMyDocuments/ "$DOCUMENT_ROOT/My Documents/"

Listen 4111             # VHOST - dont remove comment
NameVirtualHost *:4111
<VirtualHost *:4111>
    ServerName      localhost
    DocumentRoot    "$SERVER_ROOT/web/vhost/namehost1"
</VirtualHost>

<VirtualHost *:4111>
    ServerName 127.0.0.1
    DocumentRoot "$SERVER_ROOT/web/vhost/namehost2"
    ResetPipeline
    AddHandler fileHandler html
    <if EJS_MODULE>
        AddHandler ejsHandler ejs
        DirectoryIndex index.ejs
    </if>
    <Location /myEgi/>
        SetHandler egiHandler
    </Location>
</VirtualHost>

#
#   IP virtual host
#
Listen 4112             # IPHOST
<VirtualHost *:4112>
    DocumentRoot "$SERVER_ROOT/web/vhost/iphost"
    AuthType basic
    AuthName "Acme Inc"
    Require user mary
</VirtualHost>

#
#   Directories to test basic authentication (see testAuth)
#
<Directory $DOCUMENT_ROOT/basic>
    AuthType basic
    AuthName "Acme Inc"
    Require valid-user
</Directory>
<Directory $DOCUMENT_ROOT/basic/group>
    AuthType basic
    AuthName "Acme Inc"
    Require group acmeExec
</Directory>
<Directory $DOCUMENT_ROOT/basic/user>
    AuthType basic
    AuthName "Acme Inc"
    Require user joshua
</Directory>
<Directory $DOCUMENT_ROOT/digest>
    AuthType digest
    AuthName "Acme Inc"
    Require valid-user
</Directory>
<Directory $DOCUMENT_ROOT/digest/group>
    AuthType digest
    AuthName "Acme Inc"
    Require group acmeExec
</Directory>
<Directory $DOCUMENT_ROOT/digest/user>
    AuthType digest
    AuthName "Acme Inc"
    Require user joshua
</Directory>
